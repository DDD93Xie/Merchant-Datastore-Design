#Q1
SELECT SAL.EMP_NUM, EMPDEP.EMP_LNAME, EMPDEP.EMP_FNAME, ROUND(SAL_AMOUNT,2) AS SAL_AMT
FROM table8_SAL AS SAL
LEFT JOIN (SELECT EMP.EMP_NUM, EMP.EMP_LNAME, EMP.EMP_FNAME,DEPT.DEPT_NUM
           FROM table3_DEPT AS DEPT
           LEFT JOIN table4_EMP AS EMP ON EMP.DEPT_NUM=DEPT.DEPT_NUM) AS EMPDEP
ON EMPDEP.EMP_NUM=SAL.EMP_NUM
WHERE DEPT_NUM='300' and SAL_END IS NULL
ORDER BY SAL_AMOUNT DESC; 

#Q2
SELECT T1.EMP_NUM, T1.EMP_LNAME,T1.EMP_FNAME, ROUND(T2.SAL_AMOUNT,2) AS SAL_AMT
FROM 
	(SELECT SAL.EMP_NUM, MIN(SAL_FROM) AS SALFROM, EMP.EMP_LNAME,EMP.EMP_FNAME
	FROM table8_SAL AS SAL 
	LEFT JOIN table4_EMP AS EMP 
	ON SAL.EMP_NUM=EMP.EMP_NUM
	GROUP BY SAL.EMP_NUM) AS T1
JOIN table8_SAL AS T2
ON T1.EMP_NUM=T2.EMP_NUM
WHERE T1.SALFROM=T2.SAL_FROM
ORDER BY T1.EMP_NUM;


#Q3
SELECT LINE.INV_NUM, LINE.LINE_NUM, PRO.PROD_SKU, PRO.PROD_DESCRIPT, PRO.BRAND_ID
FROM 
	(table6_LINE AS LINE 
	INNER JOIN table7_PROD AS PRO 
	ON LINE.PROD_SKU = PRO.PROD_SKU) 
INNER JOIN 
	(table6_LINE AS T1 
	INNER JOIN table7_PROD AS T2 
	ON T1.PROD_SKU = T2.PROD_SKU) 
ON LINE.INV_NUM = T1.INV_NUM 
WHERE PRO.BRAND_ID = T2.BRAND_ID AND PRO.PROD_CATEGORY = 'Sealer' OR 'Top Coat'  
ORDER BY PRO.BRAND_ID;  

#Q4
CREATE VIEW T5_VIEW AS 
(
	SELECT EMP_NUM, EMP_FNAME, EMP_LNAME, EMP_EMAIL, SUM(LINE_QTY) AS TOTAL_SOLD
	FROM
	(
		SELECT EMP_NUM, EMP_FNAME, EMP_LNAME, EMP_EMAIL, T3.PROD_SKU, LINE_QTY, BRAND_NAME, INV_DATE
		FROM
		(		
			SELECT EMP_NUM, EMP_FNAME, EMP_LNAME, EMP_EMAIL, T2.PROD_SKU, LINE_QTY, BRAND_ID, INV_DATE
			FROM
				(
				SELECT EMP_NUM, EMP_FNAME, EMP_LNAME, EMP_EMAIL, PROD_SKU, LINE_QTY, INV_DATE
				FROM 
					(
					SELECT EMP_NUM, EMP_FNAME, EMP_LNAME, EMP_EMAIL, INV_NUM, INV_DATE
					FROM table4_EMP AS EMP
					INNER JOIN table5_INV AS INV 
					ON EMP.EMP_NUM=INV.EMPLOYEE_ID) AS T1
				INNER JOIN table6_LINE AS LINE
				ON T1.INV_NUM=LINE.INV_NUM) AS T2
			INNER JOIN table7_PROD AS PROD
			ON T2.PROD_SKU=PROD.PROD_SKU) AS T3
		INNER JOIN table1_BRAND AS BRAND
		ON T3.BRAND_ID=BRAND.BRAND_ID
		WHERE INV_DATE >= '2015-11-01' AND INV_DATE<= '2015-12-05' AND BRAND_NAME='BINDER PRIME') AS T4
	GROUP BY EMP_NUM, EMP_FNAME, EMP_LNAME, EMP_EMAIL); # create view on T5 so that we can reuse it
SELECT EMP_NUM, EMP_FNAME, EMP_LNAME, EMP_EMAIL, TOTAL_SOLD
FROM T5_VIEW
WHERE TOTAL_SOLD IN (SELECT DISTINCT TOTAL_SOLD FROM T5_VIEW ORDER BY TOTAL_SOLD DESC LIMIT 1);


#Q5
SELECT DISTINCT CUST.CUST_CODE,CUST_FNAME,CUST_LNAME
FROM table2_CUST AS CUST
LEFT JOIN table5_INV AS INV ON CUST.CUST_CODE=INV.CUST_CODE
WHERE INV.EMPLOYEE_ID BETWEEN '83649' AND '83677'
ORDER BY 3,2;

#Q6
SELECT CUST.CUST_CODE,CUST_FNAME, CUST_LNAME, CUST_STREET, CUST_CITY, CUST_STATE, CUST_ZIP, INV_DATE, ROUND(INV_TOTAL,2) TOTAL
FROM table5_INV AS INV
LEFT JOIN table2_CUST AS CUST 
ON CUST.CUST_CODE=INV.CUST_CODE
WHERE CUST_STATE='AL' 
AND INV_TOTAL=(SELECT MAX(INV_TOTAL) FROM table5_INV AS INVI WHERE INVI.CUST_CODE=CUST.CUST_CODE)
ORDER BY CUST_CODE;

#07
SELECT BRAND_NAME, BRAND_TYPE,ROUND(PRODINFO.AVGPRICE,2) AS AVG_PRICE, ROUND(PRODINFO.UNIT,0) AS TOTAL_UNIT
FROM table1_BRAND AS BR
LEFT JOIN 
	(SELECT SUM(LINE_QTY) AS UNIT, PRO.BRAND_ID, AVG(PROD_PRICE) AS AVGPRICE 
	FROM table7_PROD AS PRO
	LEFT JOIN 
		(SELECT INV_TOTAL, PROD_SKU, LINE_QTY
		FROM table5_INV AS INV
		LEFT JOIN table6_LINE AS LINE
		ON INV.INV_NUM=LINE.INV_NUM)AS INVOICE
	ON PRO.PROD_SKU=INVOICE.PROD_SKU GROUP BY BRAND_ID
	) AS PRODINFO
ON BR.BRAND_ID=PRODINFO.BRAND_ID;

#08
SELECT BRAND_NAME, BRAND_TYPE,PROD_SKU,PROD_DESCRIPT,ROUND(PROD_PRICE,2) AS PRICE
FROM
	(SELECT MAX(PROD_PRICE) AS MAX_PREM_PRICE
	FROM table1_BRAND AS BR
	LEFT JOIN table7_PROD AS PRO
	ON BR.BRAND_ID=PRO.BRAND_ID 
	WHERE BRAND_TYPE='PREMIUM') AS PREM, table1_BRAND,table7_PROD
WHERE BRAND_TYPE <> 'PREMIUM' AND PROD_PRICE>MAX_PREM_PRICE

#9A
SELECT PROD_SKU
FROM table7_PROD
WHERE PROD_PRICE>50;
#9B
SELECT ROUND(SUM(PROD_PRICE*PROD_QOH),2) AS ON_HAND_VALUE
FROM table7_PROD;
#9C
SELECT COUNT(CUST_CODE),ROUND(SUM(CUST_BALANCE),2) TOTAL_BAL
FROM table2_CUST;
#9D
SELECT CUST_STATE
FROM
	(SELECT CUST_STATE, ROUND(SUM(INV_TOTAL),2) AS MOST_DOLLAR
	FROM table2_CUST AS CUST
	LEFT JOIN table5_INV AS INV
	ON CUST.CUST_CODE=INV.CUST_CODE
	GROUP BY CUST_STATE
	ORDER BY MOST_DOLLAR DESC LIMIT 3) AS TOP3_STATE;

